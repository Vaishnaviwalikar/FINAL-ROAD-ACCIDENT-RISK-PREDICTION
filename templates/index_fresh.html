<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üáÆüá≥ RoadSafe AI - NEW INTERFACE TEST</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        
        .ai-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00ff00;
            color: black;
            padding: 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 18px;
            z-index: 9999;
            border: 3px solid #000;
        }
        
        .main-title {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
        }
        
        #map { 
            height: 400px; 
            border: 5px solid #ff6b6b;
            border-radius: 15px;
        }
        
        .btn-predict {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
        }
        
        .results {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- BRIGHT GREEN AI INDICATOR -->
    <div class="ai-indicator" id="aiStatus">
        üß† NEW AI MODEL: ACTIVE ‚úÖ
    </div>

    <div class="container">
        <!-- TITLE -->
        <div class="main-title">
            <h1 style="color: #ff6b6b; font-size: 3rem;">üáÆüá≥ RoadSafe AI - FRESH INTERFACE</h1>
            <p style="font-size: 1.5rem; color: #666;">This is the NEW interface - completely different from before!</p>
            <p style="color: #4ecdc4; font-weight: bold;">Indian Cities + Real AI Model + Live Weather</p>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="controls">
                    <h3 style="color: #ff6b6b;">üèôÔ∏è Search Indian Cities</h3>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>City Name:</strong></label>
                        <select class="form-control form-control-lg" id="citySelect">
                            <option value="">Select Indian City...</option>
                            <option value="mumbai">Mumbai (Maharashtra)</option>
                            <option value="delhi">Delhi (NCR)</option>
                            <option value="bangalore">Bangalore (Karnataka)</option>
                            <option value="chennai">Chennai (Tamil Nadu)</option>
                            <option value="kolkata">Kolkata (West Bengal)</option>
                            <option value="hyderabad">Hyderabad (Telangana)</option>
                            <option value="pune">Pune (Maharashtra)</option>
                            <option value="ahmedabad">Ahmedabad (Gujarat)</option>
                            <option value="jaipur">Jaipur (Rajasthan)</option>
                            <option value="surat">Surat (Gujarat)</option>
                            <option value="lucknow">Lucknow (Uttar Pradesh)</option>
                            <option value="kanpur">Kanpur (Uttar Pradesh)</option>
                            <option value="nagpur">Nagpur (Maharashtra)</option>
                            <option value="indore">Indore (Madhya Pradesh)</option>
                            <option value="bhopal">Bhopal (Madhya Pradesh)</option>
                            <option value="patna">Patna (Bihar)</option>
                            <option value="vadodara">Vadodara (Gujarat)</option>
                            <option value="ludhiana">Ludhiana (Punjab)</option>
                            <option value="agra">Agra (Uttar Pradesh)</option>
                            <option value="nashik">Nashik (Maharashtra)</option>
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <label class="form-label"><strong>Latitude:</strong></label>
                            <input type="number" class="form-control" id="lat" value="19.0760" step="0.0001">
                        </div>
                        <div class="col-6">
                            <label class="form-label"><strong>Longitude:</strong></label>
                            <input type="number" class="form-control" id="lng" value="72.8777" step="0.0001">
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-4">
                            <label class="form-label"><strong>Hour:</strong></label>
                            <select class="form-control" id="hour">
                                <option value="8">08:00 AM</option>
                                <option value="12">12:00 PM</option>
                                <option value="14" selected>02:00 PM</option>
                                <option value="18">06:00 PM</option>
                                <option value="22">10:00 PM</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <label class="form-label"><strong>Weather:</strong></label>
                            <select class="form-control" id="weather">
                                <option value="1" selected>Clear/Sunny</option>
                                <option value="2">Cloudy</option>
                                <option value="3">Rain/Monsoon</option>
                                <option value="7">Fog/Smog</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <label class="form-label"><strong>Speed (km/h):</strong></label>
                            <select class="form-control" id="speed">
                                <option value="40">40 (City)</option>
                                <option value="60" selected>60 (Main Road)</option>
                                <option value="80">80 (Highway)</option>
                                <option value="100">100 (Expressway)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn-predict" onclick="predictRisk()">
                        üß† GET AI PREDICTION FOR INDIAN ROADS
                    </button>
                </div>
            </div>
            
            <div class="col-md-6">
                <div style="margin: 20px;">
                    <div id="map"></div>
                </div>
                
                <div class="results" id="results">
                    <h4 style="color: #4ecdc4;">üéØ AI Prediction Results</h4>
                    <div id="resultContent">
                        <p><strong>Risk Level:</strong> <span id="riskLevel">-</span></p>
                        <p><strong>Risk Score:</strong> <span id="riskScore">-</span></p>
                        <p><strong>Confidence:</strong> <span id="confidence">-</span></p>
                        <p><strong>Source:</strong> <span id="source">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Indian cities coordinates
        const cities = {
            'mumbai': {lat: 19.0760, lng: 72.8777, name: 'Mumbai'},
            'delhi': {lat: 28.7041, lng: 77.1025, name: 'Delhi'},
            'bangalore': {lat: 12.9716, lng: 77.5946, name: 'Bangalore'},
            'chennai': {lat: 13.0827, lng: 80.2707, name: 'Chennai'},
            'kolkata': {lat: 22.5726, lng: 88.3639, name: 'Kolkata'},
            'hyderabad': {lat: 17.3850, lng: 78.4867, name: 'Hyderabad'},
            'pune': {lat: 18.5204, lng: 73.8567, name: 'Pune'},
            'ahmedabad': {lat: 23.0225, lng: 72.5714, name: 'Ahmedabad'},
            'jaipur': {lat: 26.9124, lng: 75.7873, name: 'Jaipur'},
            'surat': {lat: 21.1702, lng: 72.8311, name: 'Surat'},
            'lucknow': {lat: 26.8467, lng: 80.9462, name: 'Lucknow'},
            'kanpur': {lat: 26.4499, lng: 80.3319, name: 'Kanpur'},
            'nagpur': {lat: 21.1458, lng: 79.0882, name: 'Nagpur'},
            'indore': {lat: 22.7196, lng: 75.8577, name: 'Indore'},
            'bhopal': {lat: 23.2599, lng: 77.4126, name: 'Bhopal'},
            'patna': {lat: 25.5941, lng: 85.1376, name: 'Patna'},
            'vadodara': {lat: 22.3072, lng: 73.1812, name: 'Vadodara'},
            'ludhiana': {lat: 30.9010, lng: 75.8573, name: 'Ludhiana'},
            'agra': {lat: 27.1767, lng: 78.0081, name: 'Agra'},
            'nashik': {lat: 19.9975, lng: 73.7898, name: 'Nashik'}
        };
        
        // Initialize map centered on India
        let map = L.map('map').setView([20.5937, 78.9629], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        let marker;
        
        // City selection handler
        document.getElementById('citySelect').addEventListener('change', function() {
            const cityKey = this.value;
            if (cityKey && cities[cityKey]) {
                const city = cities[cityKey];
                document.getElementById('lat').value = city.lat.toFixed(6);
                document.getElementById('lng').value = city.lng.toFixed(6);
                
                map.setView([city.lat, city.lng], 12);
                if (marker) map.removeLayer(marker);
                marker = L.marker([city.lat, city.lng]).addTo(map);
                
                // Update AI status
                document.getElementById('aiStatus').innerHTML = `üß† AI ANALYZING: ${city.name.toUpperCase()} ‚úÖ`;
            }
        });
        
        // Map click handler
        map.on('click', function(e) {
            document.getElementById('lat').value = e.latlng.lat.toFixed(6);
            document.getElementById('lng').value = e.latlng.lng.toFixed(6);
            
            if (marker) map.removeLayer(marker);
            marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
        });
        
        // Prediction function
        async function predictRisk() {
            const lat = parseFloat(document.getElementById('lat').value);
            const lng = parseFloat(document.getElementById('lng').value);
            const hour = parseInt(document.getElementById('hour').value);
            const weather = parseInt(document.getElementById('weather').value);
            const speed = parseInt(document.getElementById('speed').value);
            
            // Update AI status
            document.getElementById('aiStatus').innerHTML = 'üß† AI PROCESSING... ‚ö°';
            document.getElementById('aiStatus').style.background = '#ffff00';
            document.getElementById('aiStatus').style.color = '#000';
            
            try {
                const response = await fetch('http://localhost:8000/predict_risk', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        latitude: lat,
                        longitude: lng,
                        hour: hour,
                        weather_conditions: weather,
                        speed_limit: speed,
                        day_of_week: 3
                    })
                });
                
                const result = await response.json();
                
                // Update results
                document.getElementById('riskLevel').textContent = result.risk_level || 'Medium';
                document.getElementById('riskScore').textContent = (result.risk_value || 2.0).toFixed(2);
                document.getElementById('confidence').textContent = Math.round(result.confidence || 80) + '%';
                document.getElementById('source').textContent = result.used_model ? 'Real AI Neural Network' : 'Indian Roads Analysis';
                
                // Update AI status based on result
                if (result.used_model) {
                    document.getElementById('aiStatus').innerHTML = 'üß† REAL AI MODEL: ACTIVE ‚úÖ';
                    document.getElementById('aiStatus').style.background = '#00ff00';
                } else {
                    document.getElementById('aiStatus').innerHTML = 'üáÆüá≥ INDIAN ROADS MODE ‚úÖ';
                    document.getElementById('aiStatus').style.background = '#ff9500';
                }
                
                document.getElementById('results').style.display = 'block';
                
            } catch (error) {
                // Fallback prediction for demo
                document.getElementById('riskLevel').textContent = 'Medium';
                document.getElementById('riskScore').textContent = '2.1';
                document.getElementById('confidence').textContent = '85%';
                document.getElementById('source').textContent = 'Demo Mode - Indian Roads Optimized';
                
                document.getElementById('aiStatus').innerHTML = 'üáÆüá≥ DEMO MODE: INDIAN ROADS ‚úÖ';
                document.getElementById('aiStatus').style.background = '#ff9500';
                
                document.getElementById('results').style.display = 'block';
            }
        }
        
        // Set Mumbai as default
        document.getElementById('citySelect').value = 'mumbai';
        const mumbai = cities['mumbai'];
        map.setView([mumbai.lat, mumbai.lng], 12);
        marker = L.marker([mumbai.lat, mumbai.lng]).addTo(map);
    </script>
</body>
</html>